"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[1960],{35352:function(e,t,n){n.d(t,{Z:function(){return f},x:function(){return u}});var r=n(68079),i=n(96234),o=n(96902),a=n(91188),c=n(54896),l=n(29938),s=(0,a.ZL)()((function(e){return{resizeBar:{background:e.palette.action.disabledBackground,height:12,position:"relative",overflow:"hidden"},tick:{position:"absolute",height:"100%",pointerEvents:"none",background:e.palette.action.disabled,width:1},hiddenTick:{position:"absolute",height:"100%",width:5}}}));function u(){var e=(0,o.useRef)(null),t=(0,o.useState)(0),n=(0,i.Z)(t,2),r=n[0],a=n[1];return(0,o.useEffect)((function(){var t=setInterval((function(){var t,n=null===(t=e.current)||void 0===t?void 0:t.querySelector(".MuiDataGrid-virtualScroller");n&&a(n.scrollLeft)}),100);return function(){clearInterval(t)}}),[]),{ref:e,scrollLeft:r}}function d(e){var t=e.left,n=e.scrollLeft,r=e.idx,i=e.onDrag,a=s().classes,u=(0,o.useCallback)((function(e){i(e,r)}),[r,i]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.Z,{onDrag:u,vertical:!0,className:a.hiddenTick,style:{left:t-n-2.5}}),(0,l.jsx)("div",{style:{left:t-n},className:a.tick})]})}function f(e){for(var t=e.widths,n=e.setWidths,i=e.checkbox,a=e.scrollLeft,c=void 0===a?0:a,u=s().classes,f=[],h=i?52:0,m=0;m<t.length;m++){var p=t[m];f[m]=p+h,h+=p}var v=(0,o.useCallback)((function(e,i){var o=(0,r.Z)(t);o[i]=Math.max(o[i]+e,50),n(o)}),[t,n]);return(0,l.jsx)("div",{className:u.resizeBar,children:f.map((function(e,t){return(0,l.jsx)(d,{left:t===f.length-1?e-3:e,onDrag:v,idx:t,scrollLeft:c},t)}))})}},71960:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var r=n(33028),i=n(96902),o=n(52809),a=n(90659),c=n(4782),l=n(68079),s=n(56666),u=n(96234),d=n(25322),f=n(75717),h=n(63680),m=n(615),p=n(41637),v=n(16151),x=n(82769),j=n(41590),Z=n(35352),g=n(95802),b=n(99836),w=n(90386),k=n(71186),C=n(54417),S=n(66519),y=n(5738),M=n(30570),O=n(38238),T=n(35920),E=n(29938);function L(e){var t=e.setFilterText,n=e.setUseShoppingCart,r=e.setHideSparse,o=e.setShowOptions,c=e.showOptions,l=e.hideSparse,s=e.useShoppingCart,f=e.filterText,h=e.model,m=(0,i.useState)(null),p=(0,u.Z)(m,2),v=p[0],x=p[1];return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(C.ZP,{container:!0,spacing:4,alignItems:"center",children:[(0,E.jsx)(C.ZP,{item:!0,children:(0,E.jsx)(S.Z,{label:"Search...",value:f,onChange:function(e){return t(e.target.value)},InputProps:{endAdornment:(0,E.jsx)(y.Z,{position:"end",children:(0,E.jsx)(d.Z,{onClick:function(){return t("")},children:(0,E.jsx)(M.Z,{})})})}})}),(0,E.jsx)(C.ZP,{item:!0,children:(0,E.jsx)(d.Z,{onClick:function(e){return x(e.currentTarget)},children:(0,E.jsx)(O.Z,{})})}),(0,E.jsx)(C.ZP,{item:!0,children:(0,E.jsx)(T.Z,{model:h})})]}),(0,E.jsx)(a.Menu,{anchorEl:v,open:!!v,onClose:function(){return x(null)},onMenuItemClick:function(e,t){t(),x(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:function(){return n(!s)},type:"checkbox",checked:s},{label:"Hide sparse metadata columns",onClick:function(){return r(!l)},checked:l,type:"checkbox"},{label:"Show extra table options",onClick:function(){return o(!c)},checked:c,type:"checkbox"}]})]})}var W=n(41361),H=n(13655),I=n(35388),D=n(50543),N=n(33266),F=n(91188),R=n(21630),z=n(51467),B=(0,F.ZL)()((function(e){return{facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}}}));function G(e){var t=e.column,n=e.vals,r=e.width,o=e.dispatch,a=e.filters,c=B().classes,l=(0,i.useState)(!0),s=(0,u.Z)(l,2),f=s[0],h=s[1];return(0,E.jsxs)(H.Z,{className:c.facet,style:{width:r},children:[(0,E.jsxs)("div",{style:{display:"flex"},children:[(0,E.jsx)(I.Z,{children:t.field}),(0,E.jsx)(D.Z,{title:"Clear selection on this facet filter",children:(0,E.jsx)(d.Z,{onClick:function(){o({key:t.field,val:[]})},size:"small",children:(0,E.jsx)(M.Z,{})})}),(0,E.jsx)(D.Z,{title:"Minimize/expand this facet filter",children:(0,E.jsx)(d.Z,{onClick:function(){return h(!f)},size:"small",children:f?(0,E.jsx)(R.Z,{}):(0,E.jsx)(z.Z,{})})})]}),f?(0,E.jsx)(N.Z,{multiple:!0,native:!0,className:c.select,value:a[t.field],onChange:function(e){for(var n=e.target.options,r=[],i=n.length,a=0;a<i;a++)n[a].selected&&r.push(n[a].value);o({key:t.field,val:r})},children:n.sort((function(e,t){return e[0].localeCompare(t[0])})).map((function(e){var t=(0,u.Z)(e,2),n=t[0],r=t[1];return(0,E.jsxs)("option",{value:n,children:[n," (",r,")"]},n)}))}):null]},t.field)}function P(e){var t,n=e.rows,r=e.columns,i=e.dispatch,o=e.filters,a=e.width,c=r.slice(1),s=c.map((function(){return new Map})),d=(0,W.Z)(n);try{for(d.s();!(t=d.n()).done;){var f,h=t.value,m=(0,W.Z)(c.entries());try{for(m.s();!(f=m.n()).done;){var p=(0,u.Z)(f.value,2),v=p[0],x=p[1],j=s[v],Z="".concat(h[x.field]||""),g=j.get(Z);Z&&(void 0===g?j.set(Z,1):j.set(Z,g+1))}}catch(b){m.e(b)}finally{m.f()}}}catch(b){d.e(b)}finally{d.f()}return(0,E.jsx)("div",{children:c.map((function(e,t){return(0,E.jsx)(G,{vals:(0,l.Z)(s[t]),column:e,width:a,dispatch:i,filters:o},e.field)}))})}var _=["category","adapter","description"],A=.75,U=(0,c.observer)((function(e){var t,n=e.model,o=n.assemblyNames,c=n.view,C=n.selection,S=(0,g.getEnv)(n).pluginManager,y=(0,Z.x)(),M=y.ref,O=y.scrollLeft,T=(0,i.useState)(""),W=(0,u.Z)(T,2),H=W[0],I=W[1],D=(0,i.useState)(!1),N=(0,u.Z)(D,2),F=N[0],R=N[1],z=(0,i.useState)(),B=(0,u.Z)(z,2),G=B[0],U=B[1],V=(0,i.useState)(!1),q=(0,u.Z)(V,2),X=q[0],Y=q[1],J=(0,i.useState)(!0),K=(0,u.Z)(J,2),Q=K[0],$=K[1],ee=(0,i.useState)(400),te=(0,u.Z)(ee,2),ne=te[0],re=te[1],ie=o[0],oe=(0,g.getSession)(n),ae=(0,g.useDebounce)(H,400),ce=(0,i.useReducer)((function(e,t){return(0,r.Z)((0,r.Z)({},e),{},(0,s.Z)({},t.key,t.val))}),{}),le=(0,u.Z)(ce,2),se=le[0],ue=le[1],de=(0,i.useMemo)((function(){return n.trackConfigurations(ie).filter((function(e){return(0,k.wB)(ae,e,oe)})).map((function(e){var t,n,i=(0,b.readConfObject)(e,"metadata");return(0,r.Z)({id:e.trackId,conf:e,name:(0,v.getTrackName)(e,oe),category:null===(t=(0,b.readConfObject)(e,"category"))||void 0===t?void 0:t.join(", "),adapter:null===(n=(0,b.readConfObject)(e,"adapter"))||void 0===n?void 0:n.type,description:(0,b.readConfObject)(e,"description"),metadata:i},i)}))}),[ie,n,ae,oe]),fe=(0,i.useMemo)((function(){return _.filter((function(e){return!Q||de.map((function(t){return t[e]})).filter((function(e){return!!e})).length>5}))}),[Q,de]),he=(0,i.useMemo)((function(){return(0,l.Z)(new Set(de.flatMap((function(e){return t=e.metadata,Object.entries(t).map((function(e){var t=(0,u.Z)(e,2),n=t[0];return"string"===typeof t[1]?n:""})).filter((function(e){return!!e}));var t})))).filter((function(e){return!Q||de.map((function(t){return t.metadata[e]})).filter((function(e){return!!e})).length>5}))}),[Q,de]),me=(0,i.useMemo)((function(){return["name"].concat((0,l.Z)(fe),(0,l.Z)(he))}),[fe,he]),pe=(0,i.useState)((0,r.Z)((0,r.Z)({name:(0,g.measureGridWidth)(de.map((function(e){return e.name})),{maxWidth:500,stripHTML:!0})+15},Object.fromEntries(fe.map((function(e){return[e,(0,g.measureGridWidth)(de.map((function(t){return t[e]})),{maxWidth:400,stripHTML:!0})]})))),Object.fromEntries(he.map((function(e){return[e,(0,g.measureGridWidth)(de.map((function(t){return t.metadata[e]})),{maxWidth:400,stripHTML:!0})]}))))),ve=(0,u.Z)(pe,2),xe=ve[0],je=ve[1],Ze=(0,i.useState)(Object.fromEntries(me.map((function(e){return[e,!0]})))),ge=(0,u.Z)(Ze,2),be=ge[0],we=ge[1];(0,i.useEffect)((function(){we((function(e){return(0,r.Z)((0,r.Z)({},Object.fromEntries(me.map((function(e){return[e,!0]})))),e)}))}),[me]),(0,i.useEffect)((function(){je((function(e){return(0,r.Z)((0,r.Z)({name:e.name},Object.fromEntries(fe.filter((function(e){return be[e]})).map((function(e){return[e,(0,g.measureGridWidth)(de.map((function(t){return t[e]})),{stripHTML:!0,maxWidth:400})]})))),Object.fromEntries(he.filter((function(e){return be[e]})).map((function(e){return[e,(0,g.measureGridWidth)(de.map((function(t){return t.metadata[e]})),{stripHTML:!0,maxWidth:400})]}))))}))}),[he,be,fe,Q,de]);var ke=(0,g.useDebounce)(xe,400),Ce=[{field:"name",hideable:!1,renderCell:function(e){var t=e.value,n=e.id,r=e.row;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(x.Z,{html:t}),(0,E.jsx)(d.Z,{onClick:function(e){return U({target:e.currentTarget,id:n,conf:r.conf})},children:(0,E.jsx)(w.Z,{})})]})},width:ke.name||100}].concat((0,l.Z)(fe.map((function(e){return{field:e,width:ke[e]||100,renderCell:function(e){var t=e.value;return t?(0,E.jsx)(x.Z,{html:t}):""}}}))),(0,l.Z)(he.map((function(e){return{field:e,width:ke[e]||100,renderCell:function(e){var t=e.value;return t?(0,E.jsx)(x.Z,{html:t}):""}}})))),Se=c.tracks.map((function(e){return e.configuration.trackId})),ye=Object.entries(se).filter((function(e){return e[1].length>0}));return(0,E.jsxs)(E.Fragment,{children:[G?(0,E.jsx)(j.Z,{anchorEl:null===G||void 0===G?void 0:G.target,menuItems:(null===(t=oe.getTrackActionMenuItems)||void 0===t?void 0:t.call(oe,G.conf))||[],onMenuItemClick:function(e,t){t(),U(void 0)},open:!!G,onClose:function(){return U(void 0)}}):null,(0,E.jsx)(L,{setHideSparse:$,setShowOptions:R,setFilterText:I,setUseShoppingCart:Y,hideSparse:Q,showOptions:F,filterText:H,useShoppingCart:X,model:n}),(0,E.jsxs)("div",{ref:M,style:{display:"flex",overflow:"hidden",height:window.innerHeight*A,width:window.innerWidth*A},children:[(0,E.jsxs)("div",{style:{height:window.innerHeight*A,width:window.innerWidth*A-ne},children:[(0,E.jsx)(Z.Z,{checkbox:!0,widths:Object.values(xe),setWidths:function(e){return je(Object.fromEntries(Object.entries(xe).map((function(t,n){return[t[0],e[n]]}))))},scrollLeft:O}),(0,E.jsx)(m._,{rows:de.filter((function(e){return ye.every((function(t){var n=(0,u.Z)(t,2),r=n[0];return n[1].includes(e[r])}))})),columnVisibilityModel:be,onColumnVisibilityModelChange:function(e){return we(e)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:function(e){if(X){var t=(0,h.getRoot)(n),r=S.pluggableConfigSchemaType("track"),i=e.map((function(e){return(0,h.resolveIdentifier)(r,t,e)}));n.setSelection(i)}else{var o=Se,a=e;(0,f.transaction)((function(){o.filter((function(e){return!a.includes(e)})).map((function(e){return c.hideTrack(e)})),a.filter((function(e){return!o.includes(e)})).map((function(e){return c.showTrack(e)}))}))}},rowSelectionModel:X?C.map((function(e){return e.trackId})):Se,slots:{toolbar:F?p.n:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:Ce,rowHeight:25})]}),(0,E.jsx)(a.ResizeHandle,{vertical:!0,onDrag:function(e){return re(ne-e)},style:{background:"grey",width:5}}),(0,E.jsx)("div",{style:{width:ne,overflowY:"auto",overflowX:"hidden"},children:(0,E.jsx)(P,{width:ne-10,rows:de,columns:Ce,dispatch:ue,filters:se})})]})]})}));var V=(0,c.observer)((function(e){var t=e.handleClose;return(0,E.jsx)(a.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,E.jsx)(o.Z,{children:(0,E.jsx)(U,(0,r.Z)({},e))})})}))}}]);
//# sourceMappingURL=1960.f25f46a2.chunk.js.map